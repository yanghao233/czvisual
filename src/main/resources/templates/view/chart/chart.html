<!DOCTYPE html>
<html lang="zh-cn" xmlns:th="http://www.thymeleaf.org">
<head>
    <title>数据可视化分析</title>
    <!--    引入可视化组件-->
    <script th:src="@{/js/echarts.min.js}"></script>

    <script th:src="@{/js/jquery-3.1.1.min.js}"></script>

    <!--    引入layui相关的组件-->
    <link rel="stylesheet" th:href="@{/layui/css/layui.css}" media="all"/>
    <!--    <link rel="stylesheet" th:href="@{/laydate/theme/default/laydate.css}" media="all"/>-->
    <script th:src="@{/layui/layui.js}"></script>
    <!--    <script th:src="@{/laydate/laydate.js}"></script>-->

    <!--    引入bootstrap的相关组件-->
    <link rel="stylesheet" th:href="@{/css/bootstrap.min.css}" media="all"/>
    <script th:src="@{/js/bootstrap.min.js}"></script>

</head>
<body>
<div class="row">
    <div class="col-md-2">
        <form class="form-inline" style="margin: 30px">
            <div class="form-group" style="margin: 20px">
                <label for="startTime">起始时间</label>
                <input class="form-control" id="startTime">
            </div>
            <div class="form-group" style="margin: 20px">
                <label for="endTime">结束时间</label>
                <input class="form-control" id="endTime">
            </div>
            <button type="button" id="time_btn" class="btn btn-default" style="margin: 20px">确认</button>
        </form>

        <div class="dropdown" style="margin: 50px">
            <button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown"
                    aria-haspopup="true" aria-expanded="true">
                选择隧道
                <span class="caret"></span>
            </button>
            <ul class="dropdown-menu" aria-labelledby="dropdownMenu1">
                <li>
                    <a id="4h">4#</a>
                </li>
                <li>
                    <a id="5h">5#</a>
                </li>
            </ul>
        </div>

    </div>
    <div class="col-md-1"></div>
    <div class="col-md-9">
        <!--显示图表的容器-->
        <div id="temperature" style="width: 1000px ;height: 650px;"></div>
    </div>
</div>
<script>
    var dateArray = ['3月15', '3月16', '3月17', '3月18', '3月19', '3月20', '3月21', '3月22', '3月23', '3月24'];
    var title_temperature = '温度/℃(4#)';

    var zzmwd4 = ['58', '49.2', '43.1', '41.3', '44.1', '55.3', '52.4', '53.9', '43.2', '50.5'];
    var zzmwd5 = ['48.5', '53.8', '53.2', '49.5', '51.1', '57.7', '56.3', '63.8', '56.6', '60'];

    var hjwd4 = ['35.3', '33.4', '34.1', '24.9', '35.1', '33.8', '33.2', '36.2', '30.6', '41.6'];
    var hjwd5 = ['31.9', '34.2', '47.1', '40.2', '43.8', '44.5', '43.1', '41.1', '30.2', '34.5'];

    var wbgt4 = ['', '', '', '', '29.4', '21.8', '37.8', '30.5', '28.4', '36.6'];
    var wbgt5 = ['', '', '', '', '28.2', '35.2', '35.3', '32.7', '35.1', '32.8'];


    var chart = echarts.init($("#temperature")[0]);

    var temperature_option = {
        //设置线条的颜色
        color: ['pink', 'green', 'blue'],
        //标题
        title: {
            text: title_temperature
        },
        //图标的提示框组件
        tooltip: {
            //触发方式
            trigger: 'axis'
        },
        //图例组件
        legend: {
            //series中如果有了name，那么这里面的data可以删掉
            data: ['掌子面温度', '环境温度', 'WBGT指标']
        },
        //网格配置可以控制图标的大小
        grid: {
            left: '3%',
            right: '4%',
            bottom: '10%',
            //是否显示刻度标签
            containLabel: true
        },
        //工具箱组件，可以保存为图片等功能
        toolbox: {
            feature: {
                saveAsImage: {}
            }
        },
        //设置x轴的相关设置
        xAxis: {
            // type: "categroy",
            // //线条和坐标轴是否有缝隙
            // boundaryGap:false,
            data: dateArray
        },
        yAxis: {},
        //系列图标配置，决定显示那种类型的图标
        series: [
            {
                name: '掌子面温度',
                type: 'line',
                smooth: true,
                data: zzmwd4
            },
            {
                name: '环境温度',
                type: 'line',
                smooth: true,
                data: hjwd4
            },
            {
                name: 'WBGT指标',
                type: 'line',
                smooth: true,
                data: wbgt4
            }
        ]
    };
    //将option给myChart，把配置项给实例化对象
    chart.setOption(temperature_option);

    //究极简陋版,有时间再改吧,js的date类型可以自己纠正日期不正确的问题，所以这样也是对的
    function getNextDay(date) {
        var date1 = new Date(date.toString());
        var day = date.getDate();
        if (day == 31) {
            date1.setDate(1);
            date1.setMonth(date1.getMonth() + 1);
        } else {
            date1.setDate(day + 1);
        }
        return date1;
    }

    layui.use(['laydate', 'layer'], function () {
        var laydate = layui.laydate;
        var layer = layui.layer
        laydate.render({
            elem: '#startTime'
        });
        laydate.render({
            elem: '#endTime'
        });

        $("#time_btn").click(function () {

            var startTime = $("#startTime").val();
            var endTime = $("#endTime").val();

            if (startTime == "" || endTime == "") {
                layer.msg("要先选择时间哦！！！", {
                    icon: 2,
                    shift: 6
                });
            } else {
                var startDate = new Date(startTime);
                var endDate = new Date(endTime);

                if (startDate.getFullYear() > endDate.getFullYear()) {
                    layer.msg("起始时间要在结束时间之前哦！！！", {
                        icon: 2,
                        shift: 6
                    });
                } else if (startDate.getMonth() > endDate.getMonth()) {
                    layer.msg("起始时间要在结束时间之前哦！！！", {
                        icon: 2,
                        shift: 6
                    });
                } else if (startDate.getMonth() == endDate.getMonth() && startDate.getDate() > endDate.getDate()) {
                    layer.msg("起始时间要在结束时间之前哦！！！", {
                        icon: 2,
                        shift: 6
                    });
                } else {
                    dateArray = [];
                    while (startDate.toDateString() != endDate.toDateString()) {
                        var str = (startDate.getMonth() + 1) + "月" + startDate.getDate()
                        dateArray.push(str);
                        startDate = getNextDay(startDate);
                    }
                    dateArray.push((endDate.getMonth() + 1) + "月" + endDate.getDate());

                    var new_temperature_option = temperature_option;
                    new_temperature_option.xAxis.data = dateArray;

                    //ajax的代码就写这，后端写好之后记得给ajax函数加上url
                    //ajax这主要是根据传入不同的时间测评数据库中获取相应的数据，修改zzmwd,hjwd,wbgt指标，一次性获取到4和5的，以json的格式返回
                    //json的格式为
                    /*{
                        h4:{
                            zzmwd = [];
                            hgwd = [];
                            wbgt = [];
                        }
                        h5:
                        {
                            zzmwd = [];
                            hgwd = [];
                            wbgt = [];
                        }
                    }*/
                    /*$.ajax({
                        method: "POST",
                        dataType: "json",
                        success: function (data) {
                            zzmwd4 = data.h4.zzmwd;
                            hjwd4 = data.h4.hjwd;
                            wbgt4 = data.h4.wbgt;

                            zzmwd5 = data.h5.zzmwd;
                            hjwd5 = data.h5.hjwd;
                            wbgt5 = data.h5.wbgt;

                            if (temperature_option.title.text == "温度/℃(4#)") {
                                temperature_option.series[0].data = zzmwd4;
                                temperature_option.series[1].data = hjwd4;
                                temperature_option.series[2].data = wbgt4;
                            }else {
                                temperature_option.series[0].data = zzmwd5;
                                temperature_option.series[1].data = hjwd5;
                                temperature_option.series[2].data = wbgt5;
                            }
                            chart.setOption(new_temperature_option);
                        }
                    });*/

                    //ajax完善之后下面这一行就可以注释掉了
                    chart.setOption(new_temperature_option);

                }
            }
        });

        $("#5h").click(function () {
            temperature_option.series[0].data = zzmwd5;
            temperature_option.series[1].data = hjwd5;
            temperature_option.series[2].data = wbgt5;
            temperature_option.title.text = '温度/℃(5#)';

            chart.setOption(temperature_option);
        });

        $("#4h").click(function () {
            temperature_option.series[0].data = zzmwd4;
            temperature_option.series[1].data = hjwd4;
            temperature_option.series[2].data = wbgt4;
            temperature_option.title.text = '温度/℃(4#)';

            chart.setOption(temperature_option);
        });
    })
    ;
</script>
</body>
</html>