<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>数据可视化分析--掌子面里程</title>

    <!--    引入可视化组件-->
    <script th:src="@{/js/echarts.min.js}"></script>

    <script th:src="@{/js/jquery-3.1.1.min.js}"></script>

    <!--    引入layui相关的组件-->
    <link rel="stylesheet" th:href="@{/layui/css/layui.css}" media="all"/>
    <!--    <link rel="stylesheet" th:href="@{/laydate/theme/default/laydate.css}" media="all"/>-->
    <script th:src="@{/layui/layui.js}"></script>
    <!--    <script th:src="@{/laydate/laydate.js}"></script>-->

    <!--    引入bootstrap的相关组件-->
    <link rel="stylesheet" th:href="@{/css/bootstrap.min.css}" media="all"/>
    <script th:src="@{/js/bootstrap.min.js}"></script>


</head>
<body>
<div class="row">
    <div class="col-md-2">
        <form class="form-inline" style="margin: 30px">
            <div class="form-group" style="margin: 20px">
                <label for="startTime">起始时间</label>
                <input class="form-control" id="startTime">
            </div>
            <div class="form-group" style="margin: 20px">
                <label for="endTime">结束时间</label>
                <input class="form-control" id="endTime">
            </div>
            <button type="button" id="time_btn" class="btn btn-default" style="margin: 20px">确认</button>
        </form>

        <div class="dropdown" style="margin: 50px">
            <button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown"
                    aria-haspopup="true" aria-expanded="true">
                选择隧道
                <span class="caret"></span>
            </button>
            <ul class="dropdown-menu" aria-labelledby="dropdownMenu1">
                <li>
                    <a id="4h">4#</a>
                </li>
                <li>
                    <a id="5h">5#</a>
                </li>
            </ul>
        </div>

    </div>
    <div class="col-md-1"></div>
    <div class="col-md-9">
        <!--显示图表的容器-->
        <div id="zzmlc" style="width: 1000px ;height: 650px;"></div>
    </div>
</div>

<script>
    function getMin(arr) {
        var min = arr[0];

        for (i = 1; i < arr.length; i++) {
            if (arr[i] < min) {
                min = arr[i];
            }
        }

        return min;
    }

    function getMax(arr) {
        var max = arr[0];

        for (i = 1; i < arr.length; i++) {
            if (arr[i] > max) {
                max = arr[i];
            }
        }

        return max;
    }

    var dateArray = ['3月15', '3月16', '3月17', '3月18', '3月19', '3月20', '3月21', '3月22', '3月23', '3月24'];

    //掌子面里程默认数据
    var zzmlc5 = ['1397', '1388', '1385', '1373', '1370', '1364', '1355', '1348', '1343', '1337'];
    var zzmlc4 = ['2347.8', '2343', '2338.2', '2335.8', '2333.4', '2328', '2325', '2322', '2322', '2322'];


    var title_zzmlc = "掌子面里程(4#)";

    var chart = echarts.init($("#zzmlc")[0]);

    var zzmlc_option = {
        //设置线条的颜色
        color: ['blue'],
        //标题
        title: {
            text: title_zzmlc
        },
        //图标的提示框组件
        tooltip: {
            //触发方式
            trigger: 'axis'
        },
        //图例组件
        legend: {
            //series中如果有了name，那么这里面的data可以删掉
            data: ['掌子面里程']
        },
        //网格配置可以控制图标的大小
        grid: {
            left: '3%',
            right: '4%',
            bottom: '10%',
            //是否显示刻度标签
            containLabel: true
        },
        //工具箱组件，可以保存为图片等功能
        toolbox: {
            feature: {
                saveAsImage: {}
            }
        },
        //设置x轴的相关设置
        xAxis: {
            /*type: "categroy",
            //线条和坐标轴是否有缝隙
            boundaryGap: false,*/
            data: dateArray,
            smooth: true
        },
        yAxis: {
            min: getMin(zzmlc4) - 10,
            max: getMax(zzmlc4) + 20,

            scale: true, //自适应
            minInterval: 0.1, //分割刻度
            axisLabel: {
                // color: "#58f371",
                fontSize: 13,
                showMinLabel: false, //不显示最小刻度线值
                showMaxLabel: false //不显示最大刻度线值
            },
            axisLine: {
                lineStyle: {
                    // color: "#58f371", //最左侧Y轴颜色
                }
            },
            splitLine: { //多条横线
                show: false
            }
        },
        series:
            {
                name: '掌子面里程',
                type: 'bar',
                smooth: true,
                data: zzmlc4
            }
    };
    chart.setOption(zzmlc_option);


    //究极简陋版,有时间再改吧,js的date类型可以自己纠正日期不正确的问题，所以这样也是对的
    function getNextDay(date) {
        var date1 = new Date(date.toString());
        var day = date.getDate();
        if (day == 31) {
            date1.setDate(1);
            date1.setMonth(date1.getMonth() + 1);
        } else {
            date1.setDate(day + 1);
        }
        return date1;
    }

    layui.use(['laydate', 'layer'], function () {
        var laydate = layui.laydate;
        var layer = layui.layer
        laydate.render({
            elem: '#startTime'
        });
        laydate.render({
            elem: '#endTime'
        });

        $("#time_btn").click(function () {

            var startTime = $("#startTime").val();
            var endTime = $("#endTime").val();

            if (startTime == "" || endTime == "") {
                layer.msg("要先选择时间哦！！！", {
                    icon: 2,
                    shift: 6
                });
            } else {
                var startDate = new Date(startTime);
                var endDate = new Date(endTime);

                if (startDate.getFullYear() > endDate.getFullYear()) {
                    layer.msg("起始时间要在结束时间之前哦！！！", {
                        icon: 2,
                        shift: 6
                    });
                } else if (startDate.getMonth() > endDate.getMonth()) {
                    layer.msg("起始时间要在结束时间之前哦！！！", {
                        icon: 2,
                        shift: 6
                    });
                } else if (startDate.getMonth() == endDate.getMonth() && startDate.getDate() > endDate.getDate()) {
                    layer.msg("起始时间要在结束时间之前哦！！！", {
                        icon: 2,
                        shift: 6
                    });
                } else {
                    dateArray = [];
                    while (startDate.toDateString() != endDate.toDateString()) {
                        var str = (startDate.getMonth() + 1) + "月" + startDate.getDate()
                        dateArray.push(str);
                        startDate = getNextDay(startDate);
                    }
                    dateArray.push((endDate.getMonth() + 1) + "月" + endDate.getDate());


                    zzmlc_option.xAxis.data = dateArray;

                    //返回的json格式为,返回的数组中长度必须和选中的日期的长度一致，就是没有数据的也要填充一个空字符串进去
                    /*var data = {
                        h4:{
                            zzmlc:[]
                        },
                        h5:{
                            zzmlc:[]
                        }
                    };*/
                    /*$.ajax({
                        method: "POST",
                        dataType: "json",
                        success: function (data) {
                            zzmlc4 = data.h4.zzmlc;
                            zzmlc5 = data.h5.zzmlc;

                            if (zzmlc_option.title.text == "掌子面湿度(4#)") {
                                zzmlc_option.series.data = zzmlc4;
                            } else {
                                zzmlc_option.series.data = zzmlc5;
                            }

                            chart.setOption(zzmlc_option);
                        }
                    });*/
                    chart.setOption(zzmlc_option);

                }
            }
        });

        $("#5h").click(function () {
            zzmlc_option.series.data = zzmlc5;
            zzmsd_option.title.text = "掌子面里程(5#)";
            chart.setOption(zzmlc_option);
        });

        $("#4h").click(function () {
            zzmlc_option.series.data = zzmlc4;
            zzmsd_option.title.text = "掌子面里程(4#)";
            chart.setOption(zzmlc_option);
        });
    });
</script>
</body>
</html>